var CoreTable = function() {$(window).bind('scroll',function(){	if (document.body.scrollTop > $('#main-table').position().top) {		$('#main-table tr').addClass('fixed');	} else {		$('#main-table tr').removeClass('fixed');	}}).bind('popstate',function(event){	HistoryHandler.deserializeURL(location.href);})$('#headers a').on('click',function(){	UrlHolder.sorting.criterion=$(this).attr('val');	var nearestSibling = $(this).prev();		if (UrlHolder.sorting.asc) {			UrlHolder.sorting.asc = false;			Utils.arrowsCleanUp();			nearestSibling.hide();			nearestSibling.prev().show();		} else {			Utils.arrowsCleanUp();			UrlHolder.sorting.asc = true;			nearestSibling.prev().hide();			nearestSibling.show();		}	HistoryHandler.serializeParam(UrlHolder);})$('#cities option').on('click',function(){	UrlHolder.activities=$(this).val();	fetchDataByCity(UrlHolder.activities);	HistoryHandler.serializeParam(UrlHolder);})$('#paging a').on('click',function(){	Utils.pointSelectedPage($(this));	UrlHolder.paging=$(this).text();	HistoryHandler.serializeParam(UrlHolder);})$('#filter-key').bind('keyup',function(){	UrlHolder.filterKey=$(this).val();	fetchDataByNameOrDescr(UrlHolder.filterKey);	HistoryHandler.serializeParam(UrlHolder);})//TODO remove to appropriate classfunction fetchDataByNameOrDescr(key){var storage = window.localStorage;	 for (var i=0;i<storage.length;i++){			if (storage.getItem('lastID')!=null && storage.key(i).indexOf('personData')!=-1){			var name = $.parseJSON(storage.getItem(storage.key(i)))['namesur'];			var descr = $.parseJSON(storage.getItem(storage.key(i)))['descr'];			var id2Remove = $.parseJSON(storage.getItem(storage.key(i)))['id']; 						if (name.indexOf(key)!=-1 || descr.indexOf(key)!=-1 && $('#filter-key').val()!=''){							$('#'+id2Remove).parent().parent().show();						} else {							$('#'+id2Remove).parent().parent().hide();						}						if ($('#filter-key').val()==''){							$('#'+id2Remove).parent().parent().hide();							$('#main-table tr').show();						} 			}		}}function fetchDataByCity(key){var storage = window.localStorage;	 for (var i=0;i<storage.length;i++){			if (storage.getItem('lastID')!=null && storage.key(i).indexOf('personData')!=-1){			var city = $.parseJSON(storage.getItem(storage.key(i)))['city'];			var id2Remove = $.parseJSON(storage.getItem(storage.key(i)))['id']; 						if (city.indexOf(key)!=-1 && $('#cities option').val()!=''){							$('#'+id2Remove).parent().parent().show();						} else {							$('#'+id2Remove).parent().parent().hide();						}						if ($('#cities option').val()==''){							$('#'+id2Remove).parent().parent().hide();							$('#main-table tr').show();						} 			}		}}var Utils = {	arrowsCleanUp:function(){		//TODO would be nice to join these 2 selectors		$("span[val='asc']").each(function(){			$(this).hide();		});		$("span[val='desc']").each(function(){			$(this).hide();		});	},	pointSelectedPage:function(elem){		 $('#paging a').each(function(){			$(this).removeClass('page-selected');		 })		elem.addClass('page-selected');	}}//class,that operates serialization/deserialization against URL changesvar HistoryHandler = {	serializeParam:function(urlHolder){		$.ajax({			url:location.href,			type:"GET",			data:urlHolder,			success:this.setURL(urlHolder)		})	},	setURL:function(obj){		//var isHistory = !!(window.history && history.pushState);		// isHistory param changed to try() catch() block		try {			var url = location.href;			var isParametrizedUrl = url.indexOf('?')!=-1;				if (isParametrizedUrl){					url = url.substr(0,url.indexOf('?'));				}			loc = url + this.urlBuilder(obj);			history.pushState(null, null, loc);		} catch(e){			throw new Error("History is not supported" + e);		}	},		urlBuilder:function(obj){		return '?paging=' + obj.paging + '&sorting=' + obj.sorting.criterion + '&asc=' + obj.sorting.asc + '&activities=' + obj.activities + '&filter-key=' + obj.filterKey;	},	deserializeURL:function(location){		var params = location.substr(location.indexOf('?') + 1,location.length-1);		var t = params.split('&');		return this.array2Obj(t);	},		array2Obj:function(arr){		for (var y = 0;y < arr.length; y++) {		var curElem = arr[y];			if(arr[y].indexOf('paging')!=-1){				this.UrlHolder.paging = this.extractUrlParamVal(curElem);			}else if (arr[y].indexOf('sorting')!=-1) {				this.UrlHolder.sorting = this.extractUrlParamVal(curElem);			}else if (arr[y].indexOf('activities')!=-1) {				this.UrlHolder.activities = this.extractUrlParamVal(curElem);			}else if (arr[y].indexOf('filter-key')!=-1) {				this.UrlHolder.filterKey = this.extractUrlParamVal(curElem);			}		}		return UrlHolder;	},		extractUrlParamVal:function(curElem){		curElem.substr(curElem.indexOf('=')+1,curElem.length-1);	}};var Sorting = {	criterion:"name",	asc:true};var UrlHolder = {	activities:"all",	sorting:Sorting,	filterKey:""};}